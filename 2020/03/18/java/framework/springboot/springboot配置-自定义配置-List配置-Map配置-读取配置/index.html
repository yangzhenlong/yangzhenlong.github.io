<!DOCTYPE html>
<html>
	<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scaleable=0" name="viewport">
	<title>Abulin技术站</title>
	
<link rel="stylesheet" href="/css/style.css">

	
<link rel="stylesheet" href="/css/third%20party/jquery.fancybox.css">

	<link rel="icon" href="/images/abulin.jpg">
	<link href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	<script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?822a3a1cdee727463b24d3ef09c24d4b";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
  </script>
<meta name="generator" content="Hexo 4.2.0"></head>

	<body>
		<header class="header">
	<div class="header_top">
		<span class="theme">
			<a href="/">
				Abulin 技术站
			</a>	
		</span>
		<nav class="navbar">
			<ul class="menu">
				
					<li class="menu-item">
						<i class="fa fa-"></i>
						<a href="/" class="menu-item-link">
							HOME
						</a>
					</li>
				
					<li class="menu-item">
						<i class="fa fa-"></i>
						<a href="/categories" class="menu-item-link">
							CATEGORIES
						</a>
					</li>
				
					<li class="menu-item">
						<i class="fa fa-"></i>
						<a href="/archives" class="menu-item-link">
							ARCHIVES
						</a>
					</li>
				
					<li class="menu-item">
						<i class="fa fa-"></i>
						<a href="/tags" class="menu-item-link">
							TAGS
						</a>
					</li>
				
					<li class="menu-item">
						<i class="fa fa-"></i>
						<a href="/about" class="menu-item-link">
							ABOUT
						</a>
					</li>
				
					<li class="menu-item">
						<i class="fa fa-"></i>
						<a href="/friendlink" class="menu-item-link">
							友链
						</a>
					</li>
					
			</ul>
		</nav>
	</div>
	<i id="homelink" data-link="http://yoursite.com/"></i>
	<div class="header_bottom">
		<div class="blog-title">
			<a href="https://abulin.site" target="_blank" rel="noopener" class="logo">Abulin技术站</a>
			<div class="descrs">
				<div class="descr">技术、技能、心理、情感</div>
				<div class="descr">愿你有勇敢的朋友，有厉害的对手。愿你对过往的一切情深义重，但从不回头。愿你特别美丽，特别平静，特别凶狠，也特别温柔。</div>
			</div>
			<div class="blog-down">
				<a href="javascript:void(0);">
					<i class="fa fa-angle-double-down fa-2x"></i>
				</a>
			</div>
		</div>
	</div>
</header>

		<main class="main">
			<section class="posts">
	<article class="post_full"> 
	<h1 class="post-title">
		<div class="post-title-link">
			springboot配置(自定义配置|List配置|Map配置|读取配置)
		</div>
	</h1>
	
	<div class="post-info">
		<div class="post-date">
				<i class="fa fa-calendar"></i>&nbsp2020-03-18&nbsp&nbsp&nbsp
		</div>
		
				<span class="post-words">
					<i class="fa fa-pencil-square-o"></i>&nbsp838&nbspwords&nbsp&nbsp
				</span>
				<span class="post-time">
					<i class="fa fa-clock-o"></i>&nbsp4 mins&nbsp&nbsp&nbsp
				</span>
		
		<div class="post-tags">
			
    
        <i class="fa fa-tags"></i>  <a href="/tags/springboot/"> springboot</a> <a href="/tags/springboot配置/"> springboot配置</a>
    
		</div>
	</div>
	<div class="post-content">
		<h1 id="配置文件说明"><a href="#配置文件说明" class="headerlink" title="配置文件说明"></a>配置文件说明</h1><p>springboot的默认配置都封装 <code>spring-boot-autoconfigure-xx版本.jar/META-INF/additional-spring-configuration-metadata.json</code>文件中</p>
<p><img src="https://oscimg.oschina.net/oscnet/20d93e61fb7aee75423cf1fa2a798e6c999.jpg" alt=""></p>
<p>打开这个文件，比如搜索端口配置 <code>server.port</code>，看到默认为8080</p>
<a id="more"></a>

<p><img src="https://oscimg.oschina.net/oscnet/a882560163e802104c8427287db7bbb52fa.jpg" alt=""></p>
<p>springboot常用的配置文件有 yaml和properties格式</p>
<p>在springboot项目<code>src/main/resources</code>目录新建<code>application.yml</code>文件，添加内容：</p>
<pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8081</span></code></pre>
<p>启动项目后，端口变为8081，打印日志：</p>
<pre><code>Tomcat started on port(s): 8081 (http) with context path &#39;&#39;</code></pre><h1 id="读取配置的3种方式"><a href="#读取配置的3种方式" class="headerlink" title="读取配置的3种方式"></a>读取配置的3种方式</h1><p>在配置中添加自定义配置：</p>
<pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">myconfig</span><span class="token punctuation">:</span>
  <span class="token key atrule">user</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> 哈哈哈
    <span class="token key atrule">sex</span><span class="token punctuation">:</span> <span class="token number">1</span>
    <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">20</span></code></pre>
<p>下面通过3中方式来读取配置的值</p>
<h2 id="Value"><a href="#Value" class="headerlink" title="@Value"></a><a href="https://my.oschina.net/u/3193899" target="_blank" rel="noopener">@Value</a></h2><pre class=" language-java"><code class="language-java"><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Autowired<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Value<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>SpringApplication<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>SpringBootApplication<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>GetMapping<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>RestController<span class="token punctuation">;</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigApp</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>ConfigApp<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment" spellcheck="true">//@Value("myconfig.user.name")//结果：name=myconfig.user.name 不会从配置取值，相当于直接赋值</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${myconfig.user.name}"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//结果 配置中的姓名</span>
    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${myconfig.user.sex}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> sex<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${myconfig.user.age}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 测试接口</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/user"</span><span class="token punctuation">)</span>
    String <span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        StringBuilder sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"@Value形式获取配置参数：\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"name=%s, sex=%s, age=%s \n"</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> sex<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>测试结果:</p>
<pre><code>@Value形式获取配置参数：
name=哈哈哈, sex=1, age=20 </code></pre><h2 id="配置类"><a href="#配置类" class="headerlink" title="配置类"></a>配置类</h2><p>也可以自己新建一个配置类，只需要说明配置的前缀<code>@ConfigurationProperties(prefix = &quot;前缀名&quot;)</code>，会自动匹配类字段。<br>如前面的user配置：</p>
<pre><code>import lombok.Data;
import org.springframework.boot.context.properties.ConfigurationProperties;
import org.springframework.context.annotation.Configuration;
@Configuration
@ConfigurationProperties(prefix = &quot;myconfig.user&quot;)//前缀
@Data
public class User {
    private String name;//自动匹配name
    private int sex;//自动匹配sex
    private int age;//自动匹配age
}</code></pre><p>测试：</p>
<pre><code>@Autowired
User user;
@GetMapping(&quot;/user&quot;)
    String user() {
        StringBuilder sb = new StringBuilder();
        sb.append(&quot;\n\n---------------------------------------\n\n&quot;);
        sb.append(&quot;从配置类中获取配置：\n&quot;);
        sb.append(user);
        return sb.toString();
    }</code></pre><p>结果：</p>
<pre><code>---------------------------------------

从配置类中获取配置：
User(name=哈哈哈, sex=1, age=20)</code></pre><h2 id="Environment"><a href="#Environment" class="headerlink" title="Environment"></a>Environment</h2><p>从环境信息中读取配置</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Autowired</span>
Environment env<span class="token punctuation">;</span>

<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/user"</span><span class="token punctuation">)</span>
    String <span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        StringBuilder sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"从Environment中获取配置：\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>env<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"myconfig.user.name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//注意 这里不加${}</span>
        <span class="token keyword">return</span> sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span></code></pre>
<p>结果：</p>
<pre><code>从Environment中获取配置：
哈哈哈</code></pre><h1 id="配置集合-array、list、map"><a href="#配置集合-array、list、map" class="headerlink" title="配置集合 array、list、map"></a>配置集合 array、list、map</h1><h2 id="配置数组"><a href="#配置数组" class="headerlink" title="配置数组"></a>配置数组</h2><p>yml格式：</p>
<pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">myconfig</span><span class="token punctuation">:</span>
    <span class="token key atrule">arr</span><span class="token punctuation">:</span> arr<span class="token punctuation">,</span> arrarr <span class="token comment" spellcheck="true">#数组</span>
    <span class="token key atrule">list</span><span class="token punctuation">:</span> list11<span class="token punctuation">,</span>listlist <span class="token comment" spellcheck="true">#集合</span></code></pre>
<p>properties格式</p>
<pre><code>myconfig.arr[0]=arr
myconfig.arr[1]=arrarr</code></pre><p>获取数组</p>
<pre><code>@Value(&quot;${myconfig.arr}&quot;)
    private String[] arr;
    @Value(&quot;${myconfig.list}&quot;)
    private List&lt;String&gt; list;
@GetMapping(&quot;/coll&quot;)
    public String getArr(){
        return &quot;arr:=&quot; + arr[0] + &quot;,&quot;+arr[1] + &quot;\nlist=&quot;+ list;
    }</code></pre><p>测试结果：</p>
<pre><code>arr=arr,arrarr
list=[list11, listlist]</code></pre><h2 id="配置map"><a href="#配置map" class="headerlink" title="配置map"></a>配置map</h2><h3 id="使用-Value获取map的坑"><a href="#使用-Value获取map的坑" class="headerlink" title="使用@Value获取map的坑"></a>使用@Value获取map的坑</h3><p>如果直接使用<a href="https://my.oschina.net/u/3193899" target="_blank" rel="noopener">@Value</a>，启动会报错</p>
<p>yml:</p>
<pre><code>myconfig:
  map:
    k1: v1
    k2: v2</code></pre><p>java代码：</p>
<pre><code>@Value(&quot;${myconfig.map}&quot;)
private Map map;</code></pre><p>报错信息：</p>
<pre><code>Caused by: java.lang.IllegalArgumentException: Could not resolve placeholder &#39;myconfig.map&#39; in value &quot;${myconfig.map}&quot;</code></pre><p>最后找了半天资料，发现需要听过配置类来解决</p>
<h3 id="使用配置类获取map的值"><a href="#使用配置类获取map的值" class="headerlink" title="使用配置类获取map的值"></a>使用配置类获取map的值</h3><pre><code>@Configuration
@ConfigurationProperties(prefix = &quot;myconfig&quot;)
public class MyConfig {
    @Getter @Setter//必须添加getter、setter
    private Map map;
}

----
//读取配置
@Autowired private MyConfig myConfig;
    @GetMapping(&quot;/coll&quot;)
    public Map getArr(){
        return  myConfig.getMap();
    }</code></pre><p>结果：</p>
<pre><code>{k1=v1, k2=v2}</code></pre><h1 id="随机数配置"><a href="#随机数配置" class="headerlink" title="随机数配置"></a>随机数配置</h1><pre><code>myconfig:
  rand:
    str: ${random.value}
    num: ${random.int}
    num1: ${random.long}
    num2: ${random.int(10,99)}
    uuid: ${random.uuid}</code></pre><p>演示结果：</p>
<pre><code>随机数:
random.value：b02d121044d9130ea9024bc6853cf0aa 
random.int：98141319 
random.long：8353065529278943330 
random.int(10,99)：27 
random.uuid：2cd9d432-3210-48ea-bedc-cbe6fac3ecb4 </code></pre><h1 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h1><p><a href="https://gitee.com/yimingkeji/springboot.git" target="_blank" rel="noopener">https://gitee.com/yimingkeji/springboot.git</a></p>

	</div>

	<!--打赏-->
  <div class="reward">
   <div class="reward-button">赏 <span class="reward-code">
    <span class="alipay-code"> <img class="alipay-img wdp-appear" src="/images/reward/zfb.png"><b>支付宝</b> </span>
    <span class="wechat-code"> <img class="wechat-img wdp-appear" src="/images/reward/wx.png"><b>微信</b> </span>
   </div>
   <p class="reward-notice">如果文章对你有帮助，请作者喝杯咖啡吧！</p>
  </div>
  <!--打赏-->

	<div class="post-nav">
		<div class="post-nav-prev">
			
				<a href="/2020/03/18/java/framework/springboot/springboot%E5%A4%9A%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AEprofile/" rel="prev" title="springboot多环境配置profile">
					<i class="fa fa-angle-double-left"></i>&nbspspringboot多环境配置profile
				</a>
				
		</div>
		<div class="post-nav-next">
					
						<a href="/2020/03/18/java/framework/springboot/springboot%E4%B8%89%E7%A7%8D%E5%90%AF%E5%8A%A8%E6%96%B9%E5%BC%8F-main%E6%96%B9%E6%B3%95%E5%90%AF%E5%8A%A8-jar%E5%8C%85%E5%90%AF%E5%8A%A8-mvn%E5%90%AF%E5%8A%A8/" rel="next" title="springboot三种启动方式(main方法启动|jar包启动|mvn启动)">
							springboot三种启动方式(main方法启动|jar包启动|mvn启动)&nbsp<i class="fa fa-angle-double-right"></i>
						</a>
				  	
			</div>
			<div class="clear"></div>
	</div>
	<div style="text-align:center;">
  <span id="busuanzi_container_site_pv" style="font-size:14px;margin-right:20px;color:#ccc;">
      总访问量<span id="busuanzi_value_site_pv"></span>次
  </span>
  <span id="busuanzi_container_site_uv" style="font-size:14px;margin-right:20px;color:#ccc;">
    访客数<span id="busuanzi_value_site_uv"></span>人次
  </span>
</div>

</article>

<div class="post-toc">
	<div class="toc-top">
		Article Catalog
	</div>
	<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#配置文件说明"><span class="toc-text">配置文件说明</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#读取配置的3种方式"><span class="toc-text">读取配置的3种方式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Value"><span class="toc-text">@Value</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置类"><span class="toc-text">配置类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Environment"><span class="toc-text">Environment</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#配置集合-array、list、map"><span class="toc-text">配置集合 array、list、map</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#配置数组"><span class="toc-text">配置数组</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置map"><span class="toc-text">配置map</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#使用-Value获取map的坑"><span class="toc-text">使用@Value获取map的坑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用配置类获取map的值"><span class="toc-text">使用配置类获取map的值</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#随机数配置"><span class="toc-text">随机数配置</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#源码"><span class="toc-text">源码</span></a></li></ol>
</div>


    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
<script src="/js/md5.min.js"></script>
<div id="gitalk-container"></div>
<script type="text/javascript">
    var gitalk = new Gitalk({
        clientID: '2dd25deab7cdd74074aa',
        clientSecret: 'cf52ceb9f4c2fa3a6737c445149fbf55f24e2be5',
        id: window.location.pathname,
        repo: 'abulin_comments',
        owner: 'yangzhenlong',
        admin: 'yangzhenlong',
        id: md5(location.pathname)
    })
    gitalk.render('gitalk-container')
</script>







</section>

		</main>
		<footer class="footer">
	<div class="footer-info">
		<p>
			Copyright © 2019 - 2020 Abulin Blog
		</p>
		<p class="a">
			Powered by <a href="https://hexo.io/zh-cn/" target="_blank" rel="noopener">Hexo</a> | Theme - <a href="https://github.com/Chorer/hexo-theme-PureBlue" target="_blank" rel="noopener">PureBlue</a>
		</p> 
	</div>
</footer>
		<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

<script src="/js/navbar.js"></script>


<script src="/js/pace.min.js"></script>


<script src="/js/code.js"></script>


<script src="/js/load.js"></script>


<script src="/js/search.js"></script>


<script src="/js/post-except.js"></script>


	
<script src="/js/jquery.fancybox.js"></script>

	
<script src="/js/jquery.fancyboxStart.js"></script>

	
		
<script src="/js/toc.js"></script>

		
<script src="/js/jquery.toTop.js"></script>

	


	<script src="https://unpkg.com/vanilla-back-to-top@7.2.0/dist/vanilla-back-to-top.min.js"></script>
	
<script src="/js/IndexToTop.js"></script>



	<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid="></script>
















	</body>	
</html>	
